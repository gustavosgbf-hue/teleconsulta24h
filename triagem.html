<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ConsultaJ√°24h ¬∑ Triagem M√©dica</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;min-height:100vh}
body{font-family:'Outfit',sans-serif;background:#060d0b;color:rgba(255,255,255,.92);-webkit-font-smoothing:antialiased;overflow-x:hidden}

:root{
  --g1:#b4e05a;--g2:#5ee0a0;
  --line:rgba(255,255,255,.09);
  --card:rgba(255,255,255,.045);
  --muted:rgba(255,255,255,.55);
}

.bg-glow{position:fixed;inset:0;z-index:0;pointer-events:none;
  background:radial-gradient(ellipse 70vw 60vh at 10% 0%,rgba(180,224,90,.12) 0%,transparent 60%),
  radial-gradient(ellipse 50vw 40vh at 90% 10%,rgba(94,224,160,.09) 0%,transparent 55%);}

.nav{position:sticky;top:0;z-index:100;background:rgba(6,13,11,.85);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-bottom:1px solid var(--line)}
.nav__in{display:flex;align-items:center;justify-content:space-between;padding:13px 20px;gap:12px}
.nav__brand{display:flex;align-items:center;gap:8px;font-weight:600;font-size:.88rem}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--g2);animation:pulse 2s ease-in-out infinite;flex-shrink:0}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(94,224,160,.5)}50%{opacity:.8;box-shadow:0 0 0 5px rgba(94,224,160,0)}}
.nav__step{font-size:.72rem;font-weight:500;letter-spacing:.08em;text-transform:uppercase;color:rgba(255,255,255,.45)}

.screen{display:none;min-height:calc(100vh - 52px);position:relative;z-index:1}
.screen.active{display:flex;flex-direction:column}

/* IDENTIFICA√á√ÉO */
#screen-identify{align-items:center;justify-content:center;padding:20px;min-height:calc(100vh - 52px)}
.identify-box{width:min(480px,100%);border:1px solid var(--line);border-radius:22px;background:rgba(255,255,255,.03);overflow:hidden}
.identify-head{padding:22px 24px 18px;border-bottom:1px solid var(--line)}
.identify-head h1{font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:500;margin-bottom:5px}
.identify-head p{font-size:.78rem;color:var(--muted);font-weight:300}
.identify-body{padding:22px 24px;display:flex;flex-direction:column;gap:14px}
.id-label{font-size:.75rem;font-weight:500;letter-spacing:.06em;text-transform:uppercase;color:rgba(255,255,255,.45);margin-bottom:4px}
.id-input{width:100%;padding:12px 14px;border-radius:11px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.09);font-family:'Outfit',sans-serif;font-size:.9rem;font-weight:300;color:#fff;outline:none;transition:border-color .2s;-webkit-appearance:none}
.id-input::placeholder{color:rgba(255,255,255,.25)}
.id-input:focus{border-color:rgba(94,224,160,.35)}
.id-note{font-size:.72rem;color:rgba(255,255,255,.28);font-weight:300;line-height:1.6;padding:10px 14px;background:rgba(255,255,255,.02);border-radius:10px;border:1px solid rgba(255,255,255,.06)}
.id-btn{width:100%;padding:14px;border-radius:13px;border:none;background:linear-gradient(135deg,#b4e05a,#5ee0a0);color:#051208;font-family:'Outfit',sans-serif;font-weight:700;font-size:.95rem;cursor:pointer;-webkit-appearance:none;box-shadow:0 6px 24px rgba(180,224,90,.25);transition:transform .12s,box-shadow .2s}
.id-btn:hover{transform:translateY(-1px);box-shadow:0 10px 30px rgba(180,224,90,.38)}

/* TERMOS */
#screen-terms{align-items:center;justify-content:center;padding:20px;min-height:calc(100vh - 52px)}
.terms-box{width:min(580px,100%);border:1px solid var(--line);border-radius:22px;background:rgba(255,255,255,.03);overflow:hidden}
.terms-head{padding:22px 24px 18px;border-bottom:1px solid var(--line)}
.terms-head h1{font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:500;margin-bottom:5px}
.terms-head p{font-size:.78rem;color:var(--muted);font-weight:300}
.terms-body{padding:20px 24px;display:flex;flex-direction:column;gap:10px}
.titem{font-size:.82rem;font-weight:300;color:rgba(255,255,255,.6);line-height:1.7;padding-left:12px;border-left:2px solid rgba(180,224,90,.3)}
.titem strong{color:rgba(255,255,255,.85);font-weight:500;display:block;margin-bottom:2px}
.terms-foot{padding:20px 24px 26px;border-top:1px solid var(--line);background:rgba(0,0,0,.25)}
.check-row{display:flex;align-items:flex-start;gap:12px;margin-bottom:16px;cursor:pointer}
.check-row input[type=checkbox]{width:22px;height:22px;margin-top:1px;accent-color:#b4e05a;flex-shrink:0;cursor:pointer;border-radius:5px}
.check-row span{font-size:.84rem;color:rgba(255,255,255,.82);line-height:1.55;font-weight:400}
.btn-aceitar{
  width:100%;padding:15px;border-radius:14px;border:none;
  background:linear-gradient(135deg,#b4e05a,#5ee0a0);
  color:#051208;font-family:'Outfit',sans-serif;font-weight:700;font-size:1rem;
  cursor:not-allowed;opacity:.3;display:block;
  -webkit-appearance:none;appearance:none;
  box-shadow:0 6px 24px rgba(180,224,90,.15);
  transition:opacity .25s,box-shadow .25s,transform .12s;
  letter-spacing:.01em;
}
.btn-aceitar.on{opacity:1;cursor:pointer;box-shadow:0 8px 28px rgba(180,224,90,.4)}
.btn-aceitar.on:hover{transform:translateY(-1px);box-shadow:0 12px 32px rgba(180,224,90,.5)}
.btn-aceitar.on:active{transform:none}

/* TRIAGEM CHAT */
#screen-triage{flex-direction:column}
.progress-bar{height:3px;background:rgba(255,255,255,.06);flex-shrink:0}
.progress-fill{height:100%;background:linear-gradient(90deg,#b4e05a,#5ee0a0);transition:width .5s ease;width:0%}
.chat-area{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:14px;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.1) transparent}
.chat-area::-webkit-scrollbar{width:3px}
.chat-area::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:3px}
.msg{display:flex;gap:10px;align-items:flex-end;animation:msgIn .25s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg--bot{align-self:flex-start;max-width:85%}
.msg--user{align-self:flex-end;flex-direction:row-reverse;max-width:85%}
.msg__av{width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,.06);border:1px solid var(--line);display:flex;align-items:center;justify-content:center;font-size:.8rem;flex-shrink:0}
.msg__bubble{padding:11px 15px;border-radius:16px;font-size:.875rem;font-weight:300;line-height:1.65}
.msg--bot .msg__bubble{background:rgba(255,255,255,.06);border:1px solid var(--line);border-bottom-left-radius:4px;color:rgba(255,255,255,.88)}
.msg--user .msg__bubble{background-color:#b4e05a;background-image:linear-gradient(135deg,#b4e05a,#6ed49a);color:#051208;font-weight:500;border-bottom-right-radius:4px}
.typing{display:flex;gap:4px;padding:11px 15px;align-items:center}
.typing span{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.4);animation:typDot 1.2s ease-in-out infinite}
.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}
@keyframes typDot{0%,80%,100%{transform:translateY(0);opacity:.4}40%{transform:translateY(-5px);opacity:1}}
.quick-replies{display:flex;flex-wrap:wrap;gap:8px;padding:0 20px 12px}
.qr{padding:8px 16px;border-radius:999px;border:1px solid rgba(180,224,90,.3);background:rgba(180,224,90,.06);color:var(--g1);font-family:'Outfit',sans-serif;font-size:.8rem;font-weight:500;cursor:pointer;transition:background .15s;-webkit-appearance:none;appearance:none}
.qr:hover{background:rgba(180,224,90,.14)}
.input-bar{padding:12px 16px 20px;border-top:1px solid var(--line);background:rgba(6,13,11,.9);display:flex;gap:10px;align-items:flex-end;flex-shrink:0}
.input-bar textarea{flex:1;padding:10px 14px;border-radius:13px;background:rgba(255,255,255,.07);border:1px solid var(--line);color:#fff;font-family:'Outfit',sans-serif;font-size:.875rem;font-weight:300;resize:none;outline:none;min-height:42px;max-height:110px;line-height:1.5;transition:border-color .2s;-webkit-appearance:none}
.input-bar textarea::placeholder{color:rgba(255,255,255,.28)}
.input-bar textarea:focus{border-color:rgba(94,224,160,.35)}
.send-btn{width:42px;height:42px;border-radius:50%;border:none;background-color:#b4e05a;background-image:linear-gradient(135deg,#b4e05a,#5ee0a0);color:#051208;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:transform .12s;box-shadow:0 4px 14px rgba(180,224,90,.28);-webkit-appearance:none;appearance:none}
.send-btn:hover{transform:scale(1.08)}
.send-btn[disabled]{opacity:.4;cursor:not-allowed;transform:none}

/* SCREEN WHATSAPP */
.wa-head-text h2{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:500;margin-bottom:3px}
.wa-head-text p{font-size:.78rem;color:var(--muted);font-weight:300}
.wa-input::placeholder{color:rgba(255,255,255,.28)}
.wa-input:focus{border-color:rgba(94,224,160,.35)}
.wa-opt.selected,.wa-opt:hover{border-color:rgba(37,211,102,.4);background:rgba(37,211,102,.08);color:#fff}
.wa-send:hover{transform:translateY(-1px);box-shadow:0 10px 28px rgba(37,211,102,.38)}

/* ‚îÄ‚îÄ PAGAMENTO ‚îÄ‚îÄ */
#screen-payment{align-items:center;justify-content:center;padding:24px;min-height:calc(100vh - 52px)}
.pay-box{width:min(500px,100%);border:1px solid var(--line);border-radius:24px;background:rgba(255,255,255,.03);overflow:hidden;backdrop-filter:blur(8px)}
.pay-head{padding:24px 26px 20px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:14px}
.pay-icon{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,rgba(180,224,90,.18),rgba(94,224,160,.12));border:1px solid rgba(180,224,90,.25);display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0}
.pay-head-text h2{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:500;margin-bottom:3px}
.pay-head-text p{font-size:.76rem;color:var(--muted);font-weight:300}
.pay-body{padding:24px 26px}
.pay-valor{display:flex;align-items:center;justify-content:space-between;background:rgba(180,224,90,.06);border:1px solid rgba(180,224,90,.15);border-radius:16px;padding:16px 20px;margin-bottom:22px}
.pay-valor-left .label{font-size:.68rem;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:rgba(255,255,255,.35);margin-bottom:4px}
.pay-valor-left .desc{font-size:.78rem;color:rgba(255,255,255,.5);font-weight:300;margin-top:3px}
.pay-price{font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;color:#b4e05a;line-height:1}
.pay-label{font-size:.72rem;font-weight:500;letter-spacing:.08em;text-transform:uppercase;color:rgba(255,255,255,.38);margin-bottom:8px;margin-top:0}
.pay-input{width:100%;padding:12px 16px;border-radius:13px;background:rgba(255,255,255,.06);border:1px solid var(--line);color:#fff;font-family:'Outfit',sans-serif;font-size:.875rem;font-weight:300;outline:none;transition:border-color .2s;-webkit-appearance:none;appearance:none;margin-bottom:14px}
.pay-input::placeholder{color:rgba(255,255,255,.25)}
.pay-input:focus{border-color:rgba(94,224,160,.35);background:rgba(255,255,255,.08)}
.pay-btn{width:100%;padding:15px;border-radius:14px;border:none;background:linear-gradient(135deg,#b4e05a,#5ee0a0);color:#051208;font-family:'Outfit',sans-serif;font-weight:700;font-size:1rem;cursor:pointer;-webkit-appearance:none;appearance:none;box-shadow:0 6px 24px rgba(180,224,90,.28);transition:opacity .2s,transform .12s,box-shadow .2s;letter-spacing:.01em}
.pay-btn:hover{transform:translateY(-1px);box-shadow:0 10px 30px rgba(180,224,90,.4)}
.pay-btn:disabled{opacity:.45;cursor:not-allowed;transform:none;box-shadow:none}
.pay-qr-wrap{display:none;margin-top:22px;text-align:center;animation:msgIn .3s ease}
.pay-qr-wrap.show{display:block}
.pay-qr-img{width:190px;height:190px;border-radius:16px;border:2px solid rgba(180,224,90,.25);background:#fff;padding:6px;margin:0 auto 16px;display:block;box-shadow:0 8px 32px rgba(0,0,0,.4)}
.pay-copy-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 22px;border-radius:999px;border:1px solid rgba(180,224,90,.3);background:rgba(180,224,90,.07);color:#b4e05a;font-family:'Outfit',sans-serif;font-size:.82rem;font-weight:500;cursor:pointer;-webkit-appearance:none;appearance:none;transition:background .15s;margin-bottom:14px}
.pay-copy-btn:hover{background:rgba(180,224,90,.14)}
.pay-status-msg{font-size:.8rem;color:rgba(255,255,255,.4);font-weight:300}
.pay-status-msg.ok{color:#5ee0a0;font-weight:500}
.pay-divider{display:flex;align-items:center;gap:10px;margin:20px 0 0;font-size:.7rem;color:rgba(255,255,255,.2);letter-spacing:.04em}
.pay-divider::before,.pay-divider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.07)}
.pay-seguro{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:14px;font-size:.72rem;color:rgba(255,255,255,.3);font-weight:300}

/* SCREEN CONFIRMA√á√ÉO */
#screen-confirm{align-items:center;justify-content:center;padding:24px;min-height:calc(100vh - 52px)}
.confirm-box{width:min(480px,100%);border:1px solid rgba(94,224,160,.2);border-radius:24px;background:rgba(255,255,255,.03);overflow:hidden;text-align:center;padding:48px 32px}
.confirm-icon{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,rgba(180,224,90,.15),rgba(94,224,160,.1));border:1px solid rgba(94,224,160,.3);display:flex;align-items:center;justify-content:center;font-size:2rem;margin:0 auto 24px}
.confirm-title{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:500;margin-bottom:10px}
.confirm-sub{font-size:.88rem;font-weight:300;color:rgba(255,255,255,.5);line-height:1.7;margin-bottom:32px}
.confirm-card{background:rgba(94,224,160,.05);border:1px solid rgba(94,224,160,.15);border-radius:16px;padding:18px 20px;margin-bottom:24px;text-align:left}
.confirm-card-row{display:flex;justify-content:space-between;align-items:center;font-size:.8rem;padding:4px 0}
.confirm-card-row .ck{color:rgba(255,255,255,.4);font-weight:300}
.confirm-card-row .cv{color:rgba(255,255,255,.85);font-weight:500}
.confirm-wa-btn{display:inline-flex;align-items:center;gap:9px;padding:13px 24px;border-radius:14px;border:none;background:#25D366;color:#fff;font-family:'Outfit',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;-webkit-appearance:none;box-shadow:0 6px 20px rgba(37,211,102,.25);transition:transform .12s}
.confirm-wa-btn:hover{transform:translateY(-1px)}
.confirm-note{margin-top:16px;font-size:.72rem;color:rgba(255,255,255,.25);font-weight:300}

</style>
</head>
<body>

<div class="bg-glow" aria-hidden="true"></div>

<nav class="nav">
  <div class="nav__in">
    <a href="index.html" class="nav__brand" style="text-decoration:none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="30" height="30" style="flex-shrink:0">
        <defs>
          <radialGradient id="nb" cx="50%" cy="40%" r="60%"><stop offset="0%" stop-color="#0d1f17"/><stop offset="100%" stop-color="#060d0b"/></radialGradient>
          <linearGradient id="ng" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#b4e05a"/><stop offset="100%" stop-color="#5ee0a0"/></linearGradient>
          <linearGradient id="nr" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#b4e05a" stop-opacity="0.4"/><stop offset="100%" stop-color="#5ee0a0" stop-opacity="0.15"/></linearGradient>
        </defs>
        <circle cx="22" cy="22" r="21" fill="none" stroke="url(#nr)" stroke-width="0.8"/>
        <circle cx="22" cy="22" r="19.5" fill="url(#nb)"/>
        <rect x="19.5" y="10" width="3.8" height="24" rx="1.2" fill="url(#ng)"/>
        <rect x="10" y="19.5" width="24" height="3.8" rx="1.2" fill="url(#ng)"/>
        <rect x="22.5" y="19.5" width="11.5" height="3.8" rx="0" fill="url(#nb)"/>
        <polyline points="22.5,21.4 25,21.4 26.5,17 28,26 29.5,20 31,21.4 34,21.4" fill="none" stroke="url(#ng)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span style="font-family:'Playfair Display',Georgia,serif;font-style:italic;font-size:.92rem;font-weight:700;letter-spacing:-.01em">
        <span style="color:rgba(255,255,255,.93)">Consulta</span><span style="background:linear-gradient(135deg,#b4e05a,#5ee0a0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">J√°</span><span style="font-family:'Outfit',sans-serif;font-style:normal;font-size:.68rem;font-weight:500;color:rgba(255,255,255,.38);-webkit-text-fill-color:rgba(255,255,255,.38)">24h</span>
      </span>
    </a>
    <span class="nav__step" id="nav-step">TERMOS DE USO</span>
  </div>
</nav>

<!-- SCREEN 0: IDENTIFICA√á√ÉO -->
<div id="screen-identify" class="screen active">
  <div class="identify-box">
    <div class="identify-head">
      <h1>Bem-vindo</h1>
      <p>Para come√ßar, precisamos de alguns dados b√°sicos.</p>
    </div>
    <div class="identify-body">
      <div>
        <div class="id-label">Nome completo</div>
        <input class="id-input" id="idNome" type="text" placeholder="Como voc√™ se chama?" autocomplete="name"/>
      </div>
      <div>
        <div class="id-label">Seu WhatsApp</div>
        <input class="id-input" id="idTel" type="tel" placeholder="DDD + n√∫mero (ex: 98999990000)" autocomplete="tel" inputmode="numeric"/>
      </div>
      <div class="id-note">
        üîí Seus dados s√£o registrados com seguran√ßa para vincular sua identidade ao consentimento e ao atendimento m√©dico, conforme a LGPD.
      </div>
      <button class="id-btn" onclick="avancarIdentificacao()">Continuar ‚Üí</button>
    </div>
  </div>
</div>

<!-- SCREEN 1: TERMOS -->
<div id="screen-terms" class="screen">
  <div class="terms-box">
    <div class="terms-head">
      <h1>Termos de Uso e TCLE</h1>
      <p>Leia os pontos principais antes de iniciar sua triagem.</p>
    </div>
    <div class="terms-body">
      <div class="titem"><strong>Servi√ßo</strong>Orienta√ß√£o m√©dica remota por profissional com CRM ativo, conforme Resolu√ß√£o CFM n¬∫ 2.314/2022. N√£o substitui atendimento presencial em urg√™ncias.</div>
      <div class="titem"><strong>Triagem automatizada</strong>A etapa inicial utiliza intelig√™ncia artificial exclusivamente para coleta estruturada de anamnese. N√£o constitui diagn√≥stico. Toda informa√ß√£o √© revisada pelo m√©dico antes do atendimento.</div>
      <div class="titem"><strong>Transfer√™ncia de dados</strong>Para viabilizar a triagem, dados podem ser processados por provedor internacional de IA, com garantias contratuais adequadas, conforme Arts. 33‚Äì36 da LGPD.</div>
      <div class="titem"><strong>Documentos</strong>Atestados e receitas s√£o emitidos exclusivamente quando h√° indica√ß√£o cl√≠nica ap√≥s avalia√ß√£o m√©dica. N√£o s√£o autom√°ticos.</div>
      <div class="titem"><strong>Privacidade</strong>Seus dados sens√≠veis de sa√∫de s√£o tratados com sigilo, sob base legal de consentimento espec√≠fico, conforme Lei 13.709/2018 (LGPD).</div>
      <div class="titem"><strong>Veracidade</strong>Voc√™ se compromete a fornecer informa√ß√µes verdadeiras. Dados falsos comprometem a qualidade do atendimento.</div>
      <div class="titem"><strong>Emerg√™ncias</strong>Em caso de dor no peito, falta de ar grave, desmaio ou risco de vida, procure pronto-socorro imediatamente.</div>
    </div>
    <div class="terms-foot">
      <label class="check-row" for="termsCheck">
        <input type="checkbox" id="termsCheck"/>
        <span>Li e concordo com os <a href="termos.html" target="_blank" style="color:#b4e05a">Termos de Uso</a>, <a href="privacy.html" target="_blank" style="color:#b4e05a">Pol√≠tica de Privacidade</a> e TCLE, incluindo o uso de triagem automatizada por IA e eventual transfer√™ncia internacional de dados.</span>
      </label>
      <button class="btn-aceitar" id="btnAceitar">Aceitar e iniciar triagem</button>
    </div>
  </div>
</div>

<!-- SCREEN 2: TRIAGEM -->
<div id="screen-triage" class="screen">
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  <div class="chat-area" id="triageChat"></div>
  <div class="quick-replies" id="quickReplies"></div>
  <div class="input-bar">
    <textarea id="triageInput" placeholder="Digite sua resposta..." rows="1"></textarea>
    <button class="send-btn" id="triageSend" aria-label="Enviar">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </button>
  </div>
</div>



<script>
var SEU_WHATS = '5598989272727'; // seu n√∫mero

/* IDENTIFICA√á√ÉO */
#screen-identify{align-items:center;justify-content:center;padding:20px;min-height:calc(100vh - 52px)}
.identify-box{width:min(480px,100%);border:1px solid var(--line);border-radius:22px;background:rgba(255,255,255,.03);overflow:hidden}
.identify-head{padding:22px 24px 18px;border-bottom:1px solid var(--line)}
.identify-head h1{font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:500;margin-bottom:5px}
.identify-head p{font-size:.78rem;color:var(--muted);font-weight:300}
.identify-body{padding:22px 24px;display:flex;flex-direction:column;gap:14px}
.id-label{font-size:.75rem;font-weight:500;letter-spacing:.06em;text-transform:uppercase;color:rgba(255,255,255,.45);margin-bottom:4px}
.id-input{width:100%;padding:12px 14px;border-radius:11px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.09);font-family:'Outfit',sans-serif;font-size:.9rem;font-weight:300;color:#fff;outline:none;transition:border-color .2s;-webkit-appearance:none}
.id-input::placeholder{color:rgba(255,255,255,.25)}
.id-input:focus{border-color:rgba(94,224,160,.35)}
.id-note{font-size:.72rem;color:rgba(255,255,255,.28);font-weight:300;line-height:1.6;padding:10px 14px;background:rgba(255,255,255,.02);border-radius:10px;border:1px solid rgba(255,255,255,.06)}
.id-btn{width:100%;padding:14px;border-radius:13px;border:none;background:linear-gradient(135deg,#b4e05a,#5ee0a0);color:#051208;font-family:'Outfit',sans-serif;font-weight:700;font-size:.95rem;cursor:pointer;-webkit-appearance:none;box-shadow:0 6px 24px rgba(180,224,90,.25);transition:transform .12s,box-shadow .2s}
.id-btn:hover{transform:translateY(-1px);box-shadow:0 10px 30px rgba(180,224,90,.38)}

/* IDENTIFICA√á√ÉO */
function avancarIdentificacao(){
  var nome = document.getElementById('idNome').value.trim();
  var tel  = document.getElementById('idTel').value.trim().replace(/\D/g,'');
  if(!nome){ document.getElementById('idNome').focus(); return; }
  if(!tel || tel.length < 10){ document.getElementById('idTel').focus(); return; }

  // Salva globalmente
  pacienteNome = nome;
  pacienteTel  = tel;

  // Registra identifica√ß√£o no backend
  fetch('https://triagem-api.onrender.com/api/identify', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ nome:nome, tel:tel })
  }).catch(function(){});

  // Preenche campos de pagamento
  document.getElementById('payNome').value = nome;
  document.getElementById('payTel').value  = tel;

  showScreen('terms');
  document.getElementById('nav-step').textContent = 'TERMOS DE USO';
}

/* TERMOS */
var chk = document.getElementById('termsCheck');
var btn = document.getElementById('btnAceitar');
chk.addEventListener('change', function(){ btn.classList.toggle('on', chk.checked); });
btn.addEventListener('click', function(){
  if(!chk.checked) return;

  // Log de consentimento LGPD
  fetch('https://triagem-api.onrender.com/api/consent', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ nome:pacienteNome, tel:pacienteTel, versao:'termos-v1.0' })
  }).catch(function(){});

  showScreen('payment');
  document.getElementById('nav-step').textContent = 'PAGAMENTO';
});

/* SCREENS */
function showScreen(name){
  document.querySelectorAll('.screen').forEach(function(s){ s.classList.remove('active'); });
  document.getElementById('screen-'+name).classList.add('active');
}

/* STATE */
var triageHistory = [];
var anamnesis = {};
var step = 0;
var pending = false;
var modalidade = 'msg';

var SYSTEM_TRIAGE = 'Voc√™ √© um assistente de triagem m√©dica de um servi√ßo de telemedicina chamado "Pronto Atendimento Online". Conduza uma anamnese inicial estruturada em portugu√™s brasileiro, de forma emp√°tica, clara e objetiva.\n\nSiga esta ordem obrigat√≥ria:\n1. Pe√ßa o nome completo do paciente\n2. Pergunte idade e sexo\n3. Pergunte a queixa principal\n4. Pergunte h√° quanto tempo tem o sintoma e intensidade (0-10)\n5. Fa√ßa perguntas cl√≠nicas relevantes: febre, outros sintomas associados, fatores de melhora/piora\n6. Pergunte sobre doen√ßas cr√¥nicas, alergias e medicamentos em uso\n7. Pergunte se precisa de atestado ou receita\n\nIMPORTANTE:\n- Fa√ßa UMA pergunta por vez\n- Seja breve e direto\n- Use linguagem acess√≠vel\n- Quando tiver coletado todos os dados, responda APENAS com JSON: {"done":true,"summary":"[anamnese formatada]"}\n- Se identificar sinais de emerg√™ncia (dor no peito intensa, falta de ar grave, desmaio), oriente ir ao pronto-socorro imediatamente';

/* TRIAGE */
function startTriage(){
  addMsg('triageChat','bot','Ol√°! Sou o assistente de triagem do Pronto Atendimento Online. Vou fazer algumas perguntas r√°pidas para preparar seu atendimento m√©dico.\n\nPodemos come√ßar? Qual √© o seu nome completo?');
  step=1; updateProgress(1);
}

function addMsg(chatId, type, text){
  var chat = document.getElementById(chatId);
  var div = document.createElement('div');
  div.className = 'msg msg--'+type;
  var botAv = '<div class="msg__av">&#x1F3E5;</div>';
  var userAv = '<div class="msg__av">&#x1F464;</div>';
  var safe = String(text||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
  var bubble = '<div class="msg__bubble">'+safe+'</div>';
  div.innerHTML = type==='bot' ? botAv+bubble : bubble+userAv;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function showTyping(chatId){
  var chat = document.getElementById(chatId);
  var div = document.createElement('div');
  div.className='msg msg--bot'; div.id=chatId+'-typing';
  div.innerHTML='<div class="msg__av">&#x1F3E5;</div><div class="msg__bubble"><div class="typing"><span></span><span></span><span></span></div></div>';
  chat.appendChild(div); chat.scrollTop=chat.scrollHeight;
}
function removeTyping(chatId){ var el=document.getElementById(chatId+'-typing'); if(el) el.remove(); }
function updateProgress(s){ document.getElementById('progressFill').style.width=Math.min(Math.round((s/12)*100),100)+'%'; }

function setQuickReplies(opts){
  var box=document.getElementById('quickReplies'); box.innerHTML='';
  if(!opts||!opts.length) return;
  opts.forEach(function(o){
    var b=document.createElement('button'); b.className='qr'; b.textContent=o;
    b.onclick=function(){ sendTriage(o); box.innerHTML=''; };
    box.appendChild(b);
  });
}

async function sendTriage(text){
  if(!text||pending) return;
  pending=true; document.getElementById('triageSend').disabled=true;
  addMsg('triageChat','user',text);
  document.getElementById('triageInput').value='';
  document.getElementById('triageInput').style.height='auto';
  setQuickReplies([]);
  step++; updateProgress(step);
  showTyping('triageChat');
  var reply = await callAPI('/api/triage', SYSTEM_TRIAGE, triageHistory, text);
  removeTyping('triageChat');

  try {
    var clean = String(reply).replace(/```json|```/g,'').trim();
    var parsed = JSON.parse(clean);
    if(parsed.done && parsed.summary){
      anamnesis.summary = parsed.summary;
      updateProgress(12);
      setTimeout(function(){ finishTriage(); }, 600);
      pending=false; document.getElementById('triageSend').disabled=false;
      return;
    }
  } catch(e){}

  addMsg('triageChat','bot',reply);
  if(step===3) setQuickReplies(['Masculino','Feminino','Prefiro n√£o dizer']);
  if(step===5) setQuickReplies(['1-3','4-6','7-8','9-10']);
  if(step===7) setQuickReplies(['Sim, tenho febre','N√£o tenho febre']);
  if(step===9) setQuickReplies(['Sim','N√£o']);
  if(step===10) setQuickReplies(['Apenas atestado','Apenas receita','Ambos','Nenhum']);
  pending=false; document.getElementById('triageSend').disabled=false;
}

/* WHATSAPP SCREEN */
async function finishTriage(){
  // Disparar email para os medicos
  try {
    fetch('https://triagem-api.onrender.com/api/notify', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        nome: pacienteNome,
        tel: pacienteTel,
        triagem: anamnesis.summary || ''
      })
    });
  } catch(e){ console.warn('Notify error:', e); }

  // Mostrar tela de confirmacao
  showScreen('confirm');
  document.getElementById('nav-step').textContent = 'CONCLU√çDO';
  document.getElementById('confirmNome').textContent = pacienteNome;
  document.getElementById('confirmTel').textContent = pacienteTel;

  // Botao WhatsApp Business
  var waMsg = 'Ol√°! Acabei de concluir minha triagem no ConsultaJ√°24h. Aguardo o contato do m√©dico.';
  document.getElementById('confirmWaBtn').onclick = function(){
    window.open('https://wa.me/5598989272727?text=' + encodeURIComponent(waMsg), '_blank');
  };
}

function goToWhats(){
  showScreen('whats');
  document.getElementById('nav-step').textContent = 'FINALIZAR';
  document.getElementById('waSummary').textContent = anamnesis.summary || '';
}

function selectOpt(opt){
  modalidade = opt;
  document.getElementById('optMsg').classList.toggle('selected', opt==='msg');
  document.getElementById('optVid').classList.toggle('selected', opt==='vid');
}

function enviarWhats(){
  var phone = document.getElementById('waPhone').value.replace(/\D/g,'');
  if(!phone || phone.length < 10){
    document.getElementById('waPhone').focus();
    document.getElementById('waPhone').style.borderColor='rgba(255,100,100,.5)';
    return;
  }
  document.getElementById('waPhone').style.borderColor='';

  var mod = modalidade==='vid' ? 'üìπ Videoconfer√™ncia' : 'üí¨ Mensagem (chat)';

  // Format summary: split by comma into bullet lines
  var raw = (anamnesis.summary || '');
  var formatted = raw
    .split(/,\s*(?=[A-Z√Ä√Å√Ç√É√â√ä√ç√ì√î√ï√ö√á])/)
    .map(function(item){ return '‚Ä¢ ' + item.trim(); })
    .join('\n');

  var msg = 'üè• *Triagem conclu√≠da ‚Äî Pronto Atendimento Online*\n\n'
    + 'üìå *Modalidade solicitada:* ' + mod + '\n'
    + 'üì± *WhatsApp informado:* ' + phone + '\n\n'
    + 'üóíÔ∏è *Anamnese estruturada:*\n\n'
    + formatted + '\n\n'
    + '_(Mensagem gerada automaticamente pela triagem online)_';

  window.open('https://wa.me/'+SEU_WHATS+'?text='+encodeURIComponent(msg), '_blank');
}

/* API */
async function callAPI(endpoint, system, history, userMsg){
  history.push({role:'user', content:userMsg});
  try {
    var controller = new AbortController();
    var timeout = setTimeout(function(){ controller.abort(); }, 35000);
    var res = await fetch('https://triagem-api.onrender.com'+endpoint, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({system:system, messages:history}),
      signal: controller.signal
    });
    clearTimeout(timeout);
    if(!res.ok){ throw new Error('HTTP '+res.status); }
    var data = await res.json();
    var text = data.text || (data.content&&data.content[0]&&data.content[0].text) || '';
    if(!text) throw new Error('resposta vazia');
    history.push({role:'assistant', content:text});
    return text;
  } catch(e){
    history.pop();
    if(e.name==='AbortError') return 'O servidor demorou demais para responder. Pode ser que esteja iniciando ‚Äî aguarde 30 segundos e tente enviar a mesma mensagem novamente.';
    return 'Erro de conex√£o (' + e.message + '). Verifique sua internet e tente novamente.';
  }
}

/* INPUT HANDLERS */
var triageInput = document.getElementById('triageInput');
triageInput.addEventListener('input', function(){ this.style.height='auto'; this.style.height=Math.min(this.scrollHeight,110)+'px'; });
triageInput.addEventListener('keydown', function(e){ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendTriage(this.value.trim()); } });
document.getElementById('triageSend').addEventListener('click', function(){ sendTriage(triageInput.value.trim()); });

/* ‚îÄ‚îÄ PAGAMENTO ‚îÄ‚îÄ */
var pixCode = '';
var paymentId = '';
var paymentPoller = null;

async function gerarPix(){
  var nome = document.getElementById('payNome').value.trim();
  var tel = document.getElementById('payTel').value.trim().replace(/\D/g,'');

  if(!nome){ document.getElementById('payNome').focus(); return; }
  if(!tel || tel.length < 10){ document.getElementById('payTel').focus(); return; }

  var btn = document.getElementById('payBtn');
  btn.disabled = true;
  btn.textContent = 'Gerando QR Code...';

  try {
    var res = await fetch('https://triagem-api.onrender.com/api/payment', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ nome: nome, tel: tel })
    });
    var data = await res.json();

    if(!data.ok || !data.qr_code_base64){
      btn.disabled = false;
      btn.textContent = 'Gerar QR Code Pix';
      alert('Erro ao gerar pagamento. Tente novamente.');
      return;
    }

    pixCode = data.qr_code;
    paymentId = data.payment_id;

    document.getElementById('payQrImg').src = 'data:image/png;base64,' + data.qr_code_base64;
    document.getElementById('payQrWrap').classList.add('show');

    btn.textContent = 'QR gerado ‚Äî aguardando pagamento';

    // Polling a cada 4s para verificar pagamento
    paymentPoller = setInterval(async function(){
      try {
        var r = await fetch('https://triagem-api.onrender.com/api/payment/' + paymentId);
        var d = await r.json();
        if(d.status === 'approved'){
          clearInterval(paymentPoller);
          pagamentoConfirmado(nome, tel);
        }
      } catch(e){}
    }, 4000);

  } catch(e){
    btn.disabled = false;
    btn.textContent = 'Gerar QR Code Pix';
    alert('Erro de conex√£o. Verifique sua internet.');
  }
}

function copiarPix(){
  if(!pixCode) return;
  navigator.clipboard.writeText(pixCode).then(function(){
    var b = document.getElementById('payCopyBtn');
    b.textContent = '‚úì Copiado!';
    setTimeout(function(){ b.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copiar c√≥digo Pix'; }, 2000);
  });
}

var pacienteNome = '';
var pacienteTel = '';

function pagamentoConfirmado(nome, tel){
  clearInterval(paymentPoller);
  pacienteNome = nome;
  pacienteTel = tel;
  document.getElementById('payStatusMsg').textContent = '‚úì Pagamento confirmado! Iniciando triagem...';
  document.getElementById('payStatusMsg').classList.add('ok');
  setTimeout(function(){
    showScreen('triage');
    document.getElementById('nav-step').textContent = 'TRIAGEM M√âDICA';
    startTriage();
  }, 1500);
}

</script>

<!-- SCREEN: PAGAMENTO -->
<div id="screen-payment" class="screen">
  <div class="pay-box">
    <div class="pay-head">
      <div class="pay-icon">üí≥</div>
      <div class="pay-head-text">
        <h2>Pagamento seguro</h2>
        <p>Pix instant√¢neo via Mercado Pago</p>
      </div>
    </div>
    <div class="pay-body">
      <div class="pay-valor">
        <div class="pay-valor-left">
          <div class="label">Consulta m√©dica online</div>
          <div class="desc">Receitas e atestados quando indicados</div>
        </div>
        <div class="pay-price">R$&nbsp;49,90</div>
      </div>

      <div class="pay-label">Seu nome</div>
      <input class="pay-input" id="payNome" type="text" placeholder="Nome completo" autocomplete="name"/>

      <div class="pay-label">Seu WhatsApp</div>
      <input class="pay-input" id="payTel" type="tel" placeholder="DDD + n√∫mero (ex: 98999990000)" autocomplete="tel" inputmode="numeric"/>

      <button class="pay-btn" id="payBtn" onclick="gerarPix()">
        Gerar QR Code Pix
      </button>
      <p style="text-align:center;font-size:.75rem;font-weight:300;color:rgba(255,255,255,.35);margin-top:12px;line-height:1.6;">
        ‚úì Ap√≥s confirma√ß√£o do pagamento, sua triagem inicia automaticamente.<br>Nenhuma a√ß√£o adicional necess√°ria.
      </p>

      <!-- QR CODE -->
      <div class="pay-qr-wrap" id="payQrWrap">
        <img id="payQrImg" class="pay-qr-img" src="" alt="QR Code Pix"/>
        <br/>
        <button class="pay-copy-btn" id="payCopyBtn" onclick="copiarPix()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
          Copiar c√≥digo Pix
        </button>
        <div class="pay-status-msg" id="payStatusMsg">Aguardando pagamento...</div>
      </div>

      <div class="pay-divider">pagamento processado por</div>
      <div class="pay-seguro">
        üîí Mercado Pago ¬∑ Ambiente seguro ¬∑ Dados criptografados
      </div>
    </div>
  </div>
</div>


<!-- SCREEN: CONFIRMA√á√ÉO -->
<div id="screen-confirm" class="screen">
  <div class="confirm-box">
    <div class="confirm-icon">‚úì</div>
    <h2 class="confirm-title">Triagem recebida!</h2>
    <p class="confirm-sub">Sua triagem foi enviada para nossa equipe m√©dica.<br>Um m√©dico entrar√° em contato no seu WhatsApp em breve.</p>
    <div class="confirm-card">
      <div class="confirm-card-row"><span class="ck">Paciente</span><span class="cv" id="confirmNome">‚Äî</span></div>
      <div class="confirm-card-row"><span class="ck">WhatsApp</span><span class="cv" id="confirmTel">‚Äî</span></div>
      <div class="confirm-card-row"><span class="ck">Status</span><span class="cv" style="color:#5ee0a0">‚úì Triagem conclu√≠da</span></div>
    </div>
    <button class="confirm-wa-btn" id="confirmWaBtn">
      <svg viewBox="0 0 32 32" fill="white" width="18" height="18"><path d="M16 3C9.4 3 4 8.2 4 14.7c0 2.6.8 5 2.3 7.1L4 29l7.4-2.3c2 .9 4.2 1.3 6.6 1.3 6.6 0 12-5.2 12-11.7S22.6 3 16 3zm6.8 16.6c-.3.8-1.8 1.6-2.5 1.7-.6.1-1.3.2-2.1-.1-.5-.2-1.2-.4-2.1-.8-3.7-1.6-6.1-5.4-6.3-5.6-.2-.3-1.5-2-.1-3.8.3-.4.7-.6 1-.6h.7c.2 0 .5 0 .7.5.3.7 1 2.3 1.1 2.4.1.1.1.4 0 .6-.1.2-.2.4-.4.6-.2.2-.3.4-.5.6-.2.2-.3.4-.1.7.2.3 1 1.6 2.2 2.6 1.5 1.3 2.7 1.7 3 1.9.3.2.5.1.7-.1.2-.2.8-.9 1-1.2.2-.3.4-.2.7-.1.3.1 1.8.8 2.1.9.3.2.5.3.6.5.1.2.1 1.2-.2 2z"/></svg>
      Confirmar no WhatsApp
    </button>
    <p class="confirm-note">Voc√™ tamb√©m receber√° contato direto do m√©dico respons√°vel.</p>
  </div>
</div>

</body>
</html>
